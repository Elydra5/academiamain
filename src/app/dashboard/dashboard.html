<div class="page-container">
  <div class="header">
    <div class="header-content">
      <div class="header-text">
        <h1 class="title">{{ 'DASHBOARD.TITLE' | translate }}</h1>
        <p class="subtitle">{{ 'DASHBOARD.SUBTITLE' | translate }}</p>
      </div>
      <button class="refresh-btn" (click)="loadDashboardData()" [title]="'DASHBOARD.REFRESH' | translate">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="23 4 23 10 17 10"/>
          <polyline points="1 20 1 14 7 14"/>
          <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
        </svg>
      </button>
    </div>
  </div>

  @if (isLoading) {
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>{{ 'COMMON.LOADING' | translate }}</p>
    </div>
  } @else {
    <div class="stats-grid">
      <div class="stat-card" (click)="navigateTo('/students')">
        <div class="stat-icon students">
          <svg viewBox="0 0 24 24" width="32" height="32" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ stats.studentsCount }}</h3>
          <p class="stat-label">{{ 'DASHBOARD.STUDENTS' | translate }}</p>
        </div>
      </div>

      <div class="stat-card" (click)="navigateTo('/groups')">
        <div class="stat-icon groups">
          <svg viewBox="0 0 24 24" width="32" height="32" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ stats.activeGroups }}</h3>
          <p class="stat-label">{{ 'DASHBOARD.ACTIVE_GROUPS' | translate }}</p>
        </div>
      </div>

      <div class="stat-card" (click)="navigateTo('/attendance')">
        <div class="stat-icon attendance">
          <svg viewBox="0 0 24 24" width="32" height="32" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ stats.todayAttendance }}</h3>
          <p class="stat-label">{{ 'DASHBOARD.TODAY_ATTENDANCE' | translate }}</p>
        </div>
      </div>

      <div class="stat-card" (click)="navigateTo('/billing')">
        <div class="stat-icon revenue">
          <svg viewBox="0 0 24 24" width="32" height="32" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="1" x2="12" y2="23"/>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
          </svg>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ formatCurrency(stats.monthlyRevenue) }}</h3>
          <p class="stat-label">{{ 'DASHBOARD.MONTHLY_REVENUE' | translate }}</p>
        </div>
      </div>
    </div>

    <div class="charts-grid">
      <div class="chart-card">
        <div class="chart-header">
          <h3 class="chart-title">{{ 'DASHBOARD.ATTENDANCE_TRENDS' | translate }}</h3>
          <p class="chart-subtitle">{{ 'DASHBOARD.LAST_30_DAYS' | translate }}</p>
        </div>
        <div class="chart-body">
          @if (attendanceTrends.length === 0) {
            <div class="empty-chart">
              <p>{{ 'DASHBOARD.NO_DATA' | translate }}</p>
            </div>
          } @else {
            <div class="bar-chart">
              @for (trend of attendanceTrends; track trend.date) {
                <div class="bar-item">
                  <div class="bar-container">
                    <div 
                      class="bar" 
                      [style.height.%]="getAttendanceBarHeight(trend.attendance_count)"
                      [title]="trend.attendance_count + ' ' + ('DASHBOARD.ATTENDANCES' | translate)"
                    ></div>
                  </div>
                  <span class="bar-label">{{ formatDate(trend.date) }}</span>
                </div>
              }
            </div>
          }
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <h3 class="chart-title">{{ 'DASHBOARD.GROUP_DISTRIBUTION' | translate }}</h3>
          <p class="chart-subtitle">{{ 'DASHBOARD.STUDENTS_PER_GROUP' | translate }}</p>
        </div>
        <div class="chart-body">
          @if (groupDistribution.length === 0) {
            <div class="empty-chart">
              <p>{{ 'DASHBOARD.NO_DATA' | translate }}</p>
            </div>
          } @else {
            <div class="group-list">
              @for (group of groupDistribution; track group.id) {
                <div class="group-item" (click)="navigateTo('/groups/' + group.id)">
                  <div class="group-info">
                    <h4 class="group-name">{{ group.name }}</h4>
                    <div class="group-stats">
                      <span class="group-stat">
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                          <circle cx="9" cy="7" r="4"/>
                        </svg>
                        {{ group.student_count }} {{ 'DASHBOARD.STUDENTS' | translate }}
                      </span>
                      <span class="group-stat">
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                          <rect x="3" y="4" width="18" height="18" rx="2"/>
                        </svg>
                        {{ group.attendance_count }} {{ 'DASHBOARD.ATTENDANCES' | translate }}
                      </span>
                    </div>
                  </div>
                  <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" class="arrow-icon">
                    <polyline points="9 18 15 12 9 6"/>
                  </svg>
                </div>
              }
            </div>
          }
        </div>
      </div>
    </div>

    <div class="chart-card full-width">
      <div class="chart-header">
        <h3 class="chart-title">{{ 'DASHBOARD.MONTHLY_BILLING' | translate }}</h3>
        <p class="chart-subtitle">{{ 'DASHBOARD.LAST_12_MONTHS' | translate }}</p>
      </div>
      <div class="chart-body">
        @if (monthlyBilling.length === 0) {
          <div class="empty-chart">
            <p>{{ 'DASHBOARD.NO_DATA' | translate }}</p>
          </div>
        } @else {
          <div class="bar-chart horizontal">
            @for (billing of monthlyBilling; track billing.month) {
              <div class="bar-item-horizontal">
                <span class="bar-label-horizontal">{{ formatMonth(billing.month) }}</span>
                <div class="bar-container-horizontal">
                  <div 
                    class="bar-horizontal" 
                    [style.width.%]="getRevenueBarHeight(billing.total_revenue)"
                    [title]="formatCurrency(billing.total_revenue)"
                  ></div>
                  <span class="bar-value">{{ formatCurrency(billing.total_revenue) }}</span>
                </div>
                <span class="bar-count">{{ billing.receipt_count }} {{ 'DASHBOARD.RECEIPTS' | translate }}</span>
              </div>
            }
          </div>
        }
      </div>
    </div>
  }
</div>
