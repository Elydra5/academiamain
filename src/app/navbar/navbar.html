@if (isAuthenticated) {
  <nav class="navbar">
    <div class="navbar-container">
      <div class="navbar-brand">
        <a routerLink="/dashboard" class="brand-link" (click)="closeMobileMenu()">
          <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
          </svg>
          <span>Academia Main()</span>
        </a>
      </div>
      
      <div class="navbar-menu desktop-menu">
        <a routerLink="/dashboard" routerLinkActive="active" class="nav-link" (click)="closeMobileMenu()">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="7" height="7"/>
            <rect x="14" y="3" width="7" height="7"/>
            <rect x="14" y="14" width="7" height="7"/>
            <rect x="3" y="14" width="7" height="7"/>
          </svg>
          {{ 'NAVBAR.DASHBOARD' | translate }}
        </a>
        <div class="dropdown" (mouseleave)="closeUserManagement()">
          <button 
            class="nav-link dropdown-toggle" 
            [class.active]="isUserManagementOpen || isRouteActive(['/students', '/groups', '/users', '/attendance'])"
            (click)="toggleUserManagement()"
            type="button"
          >
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
            <span>{{ 'NAVBAR.USER_MANAGEMENT' | translate }}</span>
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="dropdown-arrow" [class.rotated]="isUserManagementOpen">
              <polyline points="6 9 12 15 18 9"/>
            </svg>
          </button>
          @if (isUserManagementOpen) {
            <div class="dropdown-menu">
              <a routerLink="/students" routerLinkActive="active" class="dropdown-item" (click)="closeUserManagement(); closeMobileMenu()">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                  <circle cx="9" cy="7" r="4"/>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                {{ 'NAVBAR.STUDENTS' | translate }}
              </a>
              <a routerLink="/groups" routerLinkActive="active" class="dropdown-item" (click)="closeUserManagement(); closeMobileMenu()">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                  <circle cx="9" cy="7" r="4"/>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                {{ 'NAVBAR.GROUPS' | translate }}
              </a>
              <a routerLink="/users" routerLinkActive="active" class="dropdown-item" (click)="closeUserManagement(); closeMobileMenu()">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
                {{ 'NAVBAR.USERS' | translate }}
              </a>
              <a routerLink="/attendance" routerLinkActive="active" class="dropdown-item" (click)="closeUserManagement(); closeMobileMenu()">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                  <line x1="16" y1="2" x2="16" y2="6"/>
                  <line x1="8" y1="2" x2="8" y2="6"/>
                  <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
                {{ 'NAVBAR.ATTENDANCE' | translate }}
              </a>
            </div>
          }
        </div>
        <a routerLink="/calendar" routerLinkActive="active" class="nav-link" (click)="closeMobileMenu()">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
            <path d="M8 14h.01M12 14h.01M16 14h.01M8 18h.01M12 18h.01M16 18h.01"/>
          </svg>
          {{ 'NAVBAR.CALENDAR' | translate }}
        </a>
        <a routerLink="/billing" routerLinkActive="active" class="nav-link" (click)="closeMobileMenu()">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="1" x2="12" y2="23"/>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
          </svg>
          {{ 'NAVBAR.BILLING' | translate }}
        </a>
      </div>

      <div class="navbar-actions desktop-actions">
        <div class="language-selector">
          <button 
            class="lang-btn" 
            [class.active]="currentLang === 'es'"
            (click)="switchLanguage('es')"
            title="Español"
          >
            ES
          </button>
          <button 
            class="lang-btn" 
            [class.active]="currentLang === 'en'"
            (click)="switchLanguage('en')"
            title="English"
          >
            EN
          </button>
        </div>
        <a (click)="logout()" class="logout-btn" style="cursor: pointer;">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16 17 21 12 16 7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
          {{ 'NAVBAR.LOGOUT' | translate }}
        </a>
      </div>

      <button class="mobile-menu-toggle" (click)="toggleMobileMenu()" [attr.aria-label]="'Toggle menu'" [class.open]="isMobileMenuOpen">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="12" x2="21" y2="12" class="line-top"/>
          <line x1="3" y1="6" x2="21" y2="6" class="line-middle"/>
          <line x1="3" y1="18" x2="21" y2="18" class="line-bottom"/>
        </svg>
      </button>
    </div>

    @if (isMobileMenuOpen) {
      <div class="mobile-menu-overlay" (click)="closeMobileMenu()"></div>
      <div class="mobile-menu">
        <div class="mobile-menu-content">
          <a routerLink="/dashboard" routerLinkActive="active" class="mobile-nav-link" (click)="closeMobileMenu()">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="7" height="7"/>
              <rect x="14" y="3" width="7" height="7"/>
              <rect x="14" y="14" width="7" height="7"/>
              <rect x="3" y="14" width="7" height="7"/>
            </svg>
            {{ 'NAVBAR.DASHBOARD' | translate }}
          </a>
          <div class="mobile-dropdown">
            <button 
              class="mobile-nav-link mobile-dropdown-toggle" 
              [class.active]="isUserManagementOpen || isRouteActive(['/students', '/groups', '/users', '/attendance'])"
              (click)="toggleUserManagement()"
              type="button"
            >
              <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
              </svg>
              {{ 'NAVBAR.USER_MANAGEMENT' | translate }}
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mobile-dropdown-arrow" [class.rotated]="isUserManagementOpen" style="margin-left: auto;">
                <polyline points="6 9 12 15 18 9"/>
              </svg>
            </button>
            @if (isUserManagementOpen) {
              <div class="mobile-dropdown-menu">
                <a routerLink="/students" routerLinkActive="active" class="mobile-dropdown-item" (click)="closeUserManagement(); closeMobileMenu()">
                  <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                  </svg>
                  {{ 'NAVBAR.STUDENTS' | translate }}
                </a>
                <a routerLink="/groups" routerLinkActive="active" class="mobile-dropdown-item" (click)="closeUserManagement(); closeMobileMenu()">
                  <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                  </svg>
                  {{ 'NAVBAR.GROUPS' | translate }}
                </a>
                <a routerLink="/users" routerLinkActive="active" class="mobile-dropdown-item" (click)="closeUserManagement(); closeMobileMenu()">
                  <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                  </svg>
                  {{ 'NAVBAR.USERS' | translate }}
                </a>
                <a routerLink="/attendance" routerLinkActive="active" class="mobile-dropdown-item" (click)="closeUserManagement(); closeMobileMenu()">
                  <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                  </svg>
                  {{ 'NAVBAR.ATTENDANCE' | translate }}
                </a>
              </div>
            }
          </div>
          <a routerLink="/calendar" routerLinkActive="active" class="mobile-nav-link" (click)="closeMobileMenu()">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="16" y1="2" x2="16" y2="6"/>
              <line x1="8" y1="2" x2="8" y2="6"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
              <path d="M8 14h.01M12 14h.01M16 14h.01M8 18h.01M12 18h.01M16 18h.01"/>
            </svg>
            {{ 'NAVBAR.CALENDAR' | translate }}
          </a>
          <a routerLink="/billing" routerLinkActive="active" class="mobile-nav-link" (click)="closeMobileMenu()">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="1" x2="12" y2="23"/>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
            {{ 'NAVBAR.BILLING' | translate }}
          </a>
          
          <div class="mobile-menu-divider"></div>
          
          <div class="mobile-actions">
            <div class="language-selector">
              <button 
                class="lang-btn" 
                [class.active]="currentLang === 'es'"
                (click)="switchLanguage('es')"
                title="Español"
              >
                ES
              </button>
              <button 
                class="lang-btn" 
                [class.active]="currentLang === 'en'"
                (click)="switchLanguage('en')"
                title="English"
              >
                EN
              </button>
            </div>
            <a (click)="logout(); closeMobileMenu()" class="mobile-logout-btn" style="cursor: pointer;">
              <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                <polyline points="16 17 21 12 16 7"/>
                <line x1="21" y1="12" x2="9" y2="12"/>
              </svg>
              {{ 'NAVBAR.LOGOUT' | translate }}
            </a>
          </div>
        </div>
      </div>
    }
  </nav>
}
